<a class = "buttton" href = "currentWorkout.html">Current Workout</a>
<a class = "buttton" href = "Statistics.html">Statistics</a>
<a class = "buttton">History</a>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collapsible Workout Sessions</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom CSS for hidden rows, overriding Tailwind's default display property if needed */
        .hidden-row {
            display: none;
        }

        /* Basic table styling not covered by default Tailwind if you want more specific borders */
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #e2e8f0; /* Tailwind's gray-200 */
            padding: 12px 16px;
        }

        /* Style for the clickable header rows */
        .collapsible-header {
            cursor: pointer;
            background-color: #f8fafc; /* Tailwind's gray-50 */
            font-weight: bold;
            transition: background-color 0.2s ease-in-out;
        }

        .collapsible-header:hover {
            background-color: #f1f5f9; /* Tailwind's gray-100 */
        }

        .toggle-icon {
            margin-right: 8px;
            display: inline-block;
            width: 1em; /* Ensure consistent width for icon */
            text-align: center;
        }
    </style>
</head>
<body class="font-sans bg-gray-100 p-8">

    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden">
        <h1 class="text-3xl font-bold p-6 bg-blue-600 text-white text-center">My Workout Sessions</h1>

        <div class="p-6">
            <table class="min-w-full divide-y divide-gray-200 rounded-lg" id="workoutTable">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Workout Type
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Duration (min)
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Date
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Specifics
                        </th>
                    </tr>
                </thead>
                <!-- Table body content will be generated by JavaScript -->
                <tbody id="workoutTableBodyContainer">
                    <tr>
                        <td colspan="4" class="text-center py-8 text-gray-500">Loading workouts...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample workout data (if localStorage is empty)
            const sampleWorkouts = [
                { type: "hangboard", time: 30, edge: "20mm", date: "2025-06-10" },
                { type: "pinchblock", time: 45, width: "4 inches", date: "2025-06-10" },
                { type: "hangboard", time: 35, edge: "15mm", date: "2025-06-11" },
                { type: "workout", time: 60, date: "2025-06-11" },
                { type: "pinchblock", time: 50, width: "5 inches", date: "2025-06-12" },
                { type: "workout", time: 90, date: "2025-06-12" },
                { type: "hangboard", time: 25, edge: "25mm", date: "2025-06-13" }
            ];

            // Get workouts from localStorage or use sample data
            let workouts = [];
            try {
                const storedWorkouts = localStorage.getItem('sessions').sessions;
                if (storedWorkouts) {
                    workouts = JSON.parse(storedWorkouts);
                } else {
                    // If no data, use sample data and save it to localStorage
                    workouts = sampleWorkouts;
                    // localStorage.setItem('workoutSessions', JSON.stringify(sampleWorkouts));
                }
            } catch (e) {
                console.error("Failed to parse workout data from localStorage, using sample data:", e);
                workouts = sampleWorkouts;
                localStorage.setItem('workoutSessions', JSON.stringify(sampleWorkouts));
            }


            const workoutTableBodyContainer = document.getElementById('workoutTableBodyContainer');
            workoutTableBodyContainer.innerHTML = ''; // Clear initial loading message

            // Group workouts by type
            const groupedWorkouts = workouts.reduce((acc, workout) => {
                const type = workout.type.toLowerCase();
                if (!acc[type]) {
                    acc[type] = [];
                }
                acc[type].push(workout);
                return acc;
            }, {});

            // Generate table sections dynamically
            for (const type in groupedWorkouts) {
                if (groupedWorkouts.hasOwnProperty(type)) {
                    const sessionsOfType = groupedWorkouts[type];
                    const sectionId = type.replace(/\s+/g, '-'); // Create a valid ID from the type

                    // Create a new tbody for each collapsible section
                    const tbody = document.createElement('tbody');
                    tbody.classList.add('bg-white', 'divide-y', 'divide-gray-200');

                    // Create the collapsible header row for this section
                    const headerRow = document.createElement('tr');
                    headerRow.classList.add('collapsible-header');
                    headerRow.dataset.sectionId = sectionId;

                    headerRow.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="toggle-icon">+</span> ${type.charAt(0).toUpperCase() + type.slice(1)} Workouts
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="3">
                            ${sessionsOfType.length} session${sessionsOfType.length !== 1 ? 's' : ''}
                        </td>
                    `;
                    tbody.appendChild(headerRow);

                    // Add content rows for each workout in this section
                    sessionsOfType.forEach((session, index) => {
                        const contentRow = document.createElement('tr');
                        // Add classes for hidden rows and specific section targeting
                        contentRow.classList.add('collapsible-content', `section-${sectionId}`, 'hidden-row');

                        let specifics = 'N/A';
                        if (session.type === 'hangboard' && session.edge) {
                            specifics = `Edge: ${session.edge}`;
                        } else if (session.type === 'pinchblock' && session.width) {
                            specifics = `Width: ${session.width}`;
                        }

                        contentRow.innerHTML = `
                            <td class="px-6 py-4 text-sm text-gray-900 pl-12">${session.type.charAt(0).toUpperCase() + session.type.slice(1)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${session.time}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${session.date || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${specifics}</td>
                        `;
                        tbody.appendChild(contentRow);
                    });

                    // Append the completed tbody section to the main table container
                    workoutTableBodyContainer.appendChild(tbody);
                }
            }

            // Re-apply event listeners to the new collapsible headers
            const collapsibleHeaders = document.querySelectorAll('.collapsible-header');
            collapsibleHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const sectionId = this.dataset.sectionId;
                    const contentRows = document.querySelectorAll(`.collapsible-content.section-${sectionId}`);
                    const toggleIcon = this.querySelector('.toggle-icon');

                    contentRows.forEach(row => {
                        row.classList.toggle('hidden-row');
                    });

                    if (contentRows.length > 0 && contentRows[0].classList.contains('hidden-row')) {
                        toggleIcon.textContent = '+';
                    } else {
                        toggleIcon.textContent = '-';
                    }
                });
            });

            // Optional: Hide all sections initially (they are already hidden by default CSS)
            // But if you want to explicitly close them on load, you can trigger their click event.
            // collapsibleHeaders.forEach(header => {
            //     if (header.dataset.sectionId !== 'defaultOpenSection') { // Example to keep one section open
            //         header.click(); // Programmatically click to hide
            //     }
            // });
        });
    </script>

</body>
</html>
