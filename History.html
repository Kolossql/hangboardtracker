<link rel="manifest" href="manifest.json" />

<a class = "buttton" href = "currentWorkout.html">Current Workout</a>
<a class = "buttton" href = "Statistics.html">Statistics</a>
<a class = "buttton">History</a>


<style>
  /* Optional CSS for better appearance */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
  }
  th {
    background-color: #f2f2f2;
  }
  .toggle-button {
    background-color: #007bff; /* Blue */
    color: white;
    padding: 5px 10px;
    border: none;
    cursor: pointer;
    font-size: 0.8em; /* Smaller button for each row */
  }
  .hidden-row {
    display: none; /* This is the key CSS for hiding */
  }
</style>

<a id = "download">DOWNLOAD DATA</a>

<body>

<h1>Collapsible Table with Individual Row Toggles</h1>

<table id="myCollapsibleTable">
  <thead>
    <tr>
      <th >Toggle</th> <th>Workout Date</th>
      <th colspan="3">Details</th>
    </tr>
  </thead>
  <tbody>
    
  </tbody>
</table>

<script>

    function wipeData() {
            showConfirm(
                "Are you absolutely sure you want to wipe ALL stored data? This action cannot be undone.",
                () => { // onConfirm
                    localStorage.clear();
                    localStorage.sessions = JSON.stringify({ sessions: [] });
                    window.localStorage.workout = JSON.stringify({ thisSession: [], num: 0 }); // Re-initialize current workout
                    showAlert("All data has been wiped.", "Data Wiped");
                },
                () => { // onCancel
                    showAlert("Data wipe cancelled.", "Info");
                },
                "Danger: Wipe All Data"
            );
        }

    document.addEventListener('DOMContentLoaded', function() {

        //download button
        const dataString = JSON.stringify(localStorage);
        const blob = new Blob([dataString], { type: 'text' });
        const url = URL.createObjectURL(blob);
        document.getElementById("download").href = url
        document.getElementById("download").download = 'data.txt';

        let sessions = JSON.parse(window.localStorage.sessions).sessions
        console.log(sessions)
        table = document.getElementById("myCollapsibleTable")
        let c = 1
        for (let session of sessions){

            //visible row
            const controlRow = table.insertRow(-1);
            buttoncell = controlRow.insertCell(0);
            button = document.createElement('button');
            // <button class="toggle-button" data-row-id="row1">Toggle</button>
            button.classList.add("toggle-button")
            button.setAttribute("data-row-id", "row"+c)
            button.textContent = "Toggle";
            buttoncell.appendChild( button);
            date = controlRow.insertCell(1);
            date.textContent = session.shift();
            detail = controlRow.insertCell(2);
            detail.textContent = "Expand To See More"
            detail.setAttribute('colspan', '3');
            //subtitles
            titleRow = table.insertRow(-1);
            titleRow.classList.add("hidden-row")
            titleRow.classList.add("row"+c)

            typeH = titleRow.insertCell(0);
            typeH.textContent = "Type";

            dateH = titleRow.insertCell(1);

            widthH = titleRow.insertCell(2);
            widthH.textContent = "Width";

            timeH = titleRow.insertCell(3);
            timeH.textContent = "Time";

            weightH = titleRow.insertCell(4);
            weightH.textContent = "Weight";
            //


            for (let lift of session){
                console.log(lift)
                //liftRow
                liftRow = table.insertRow(-1);
                liftRow.classList.add("hidden-row")
                liftRow.classList.add("row"+c)

                type = liftRow.insertCell(0);
                type.textContent = lift.type == "h" ? "Hangboard" : "Pinch Block" 

                date = liftRow.insertCell(1);

                width = liftRow.insertCell(2);
                if (lift.type == "h") {
                    width.textContent = lift.edge + "mm"
                }else{
                    switch (lift.width) {
                        case 0: width.textContent ="Thin Wood";break;
                        case 1: width.textContent ="Wide Wood";break;
                        case 2: width.textContent ="Thin Metal";break;
                        case 3: width.textContent ="Wide Metal";break;
                    }
                }

                timeH = liftRow.insertCell(3);
                timeH.textContent = lift.time + "sec"

                weightH = liftRow.insertCell(4);
                weightH.textContent = (lift.type == "h" ? "BW+" : "" )+ lift.weight + "lbs"
            }

            c++;
        }


        // attachListeners
        // Get all toggle buttons
        var toggleButtons = document.querySelectorAll('.toggle-button');
        console.log(toggleButtons)
        // Loop through each button and attach an event listener
        toggleButtons.forEach(function(button) {
            button.addEventListener('click', function() {
            // Get the ID of the row to toggle from the data-row-id attribute
            var rowId = this.dataset.rowId; // 'this' refers to the clicked button
            var rowsToToggle = document.getElementsByClassName(rowId);
            console.log(rowsToToggle)

            // Toggle the display property
            for (let rowToToggle of rowsToToggle) {
                console.log(rowToToggle);
            if (rowToToggle.style.display === 'none' || rowToToggle.style.display === '') {
                rowToToggle.style.display = 'table-row';
            } else {
                rowToToggle.style.display = 'none';
            }}
            });
        });
    });

  
</script>

</body>
</html>